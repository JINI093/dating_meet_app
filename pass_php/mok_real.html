<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<!--  개발 URL -->
<script src="https://scert.mobile-ok.com/resources/js/index.js"></script>
<!--  운영 URL : <script src="https://cert.mobile-ok.com/resources/js/index.js"></script> -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    // 페이지 로드 시 자동으로 PASS 인증 시작
    setTimeout(function() {
        startRealPassAuth();
    }, 1000);
    
    document.querySelector("#mok_popup").addEventListener("click", function () {
        startRealPassAuth();
    });
});

function startRealPassAuth() {
    try {
        // 실제 PASS SDK 호출 - 실제 PASS 인증창 표시
        if (typeof MOBILEOK !== 'undefined') {
            console.log('실제 PASS 인증 시작');
            
            // 실제 서버의 mok_std_request.php 호출
            MOBILEOK.process("https://sagilrae.com/mok_std_request.php", "WB", "result");
            
            // 상태 메시지 업데이트
            document.querySelector("#status").textContent = "PASS 앱으로 본인인증을 진행해주세요...";
            
        } else {
            console.log('MOBILEOK SDK 로드 실패');
            document.querySelector("#status").textContent = "PASS SDK 로드 실패. 페이지를 새로고침해주세요.";
        }
    } catch (e) {
        console.error("PASS 인증 오류:", e);
        document.querySelector("#status").textContent = "인증 중 오류가 발생했습니다: " + e.message;
    }
}

// PASS 인증 결과 콜백 함수
function result(result) {
    console.log("PASS 인증 결과:", result);
    
    try {
        let resultData;
        if (typeof result === 'string') {
            resultData = JSON.parse(result);
        } else {
            resultData = result;
        }
        
        // 결과를 화면에 표시
        document.querySelector("#result").value = JSON.stringify(resultData, null, 4);
        
        // 성공 여부 확인
        if (resultData.resultCode === "2000") {
            document.querySelector("#status").textContent = "본인인증이 완료되었습니다.";
            document.querySelector("#status").style.color = "#28a745";
        } else {
            document.querySelector("#status").textContent = "인증에 실패했습니다: " + (resultData.resultMsg || "알 수 없는 오류");
            document.querySelector("#status").style.color = "#dc3545";
        }
        
        // Flutter WebView로 결과 전송
        if (window.PassChannel && window.PassChannel.postMessage) {
            window.PassChannel.postMessage(JSON.stringify(resultData));
            console.log("Flutter로 결과 전송 완료");
        } else {
            console.log("PassChannel 없음 - Flutter 통신 불가");
        }
        
    } catch (error) {
        console.error("결과 처리 오류:", error);
        document.querySelector("#result").value = result;
        document.querySelector("#status").textContent = "결과 처리 중 오류가 발생했습니다.";
        document.querySelector("#status").style.color = "#dc3545";
        
        // 오류 시에도 Flutter로 전송
        if (window.PassChannel && window.PassChannel.postMessage) {
            window.PassChannel.postMessage(result);
        }
    }
}
</script>
<style>
body {
    margin: 0;
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background-color: #f8f9fa;
}
.container {
    max-width: 500px;
    margin: 0 auto;
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    overflow: hidden;
}
.header {
    background: linear-gradient(135deg, #FF3B30, #FF6B35);
    color: white;
    padding: 24px;
    text-align: center;
}
.logo {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 8px;
}
.subtitle {
    font-size: 14px;
    opacity: 0.9;
}
.content {
    padding: 24px;
}
.status {
    text-align: center;
    padding: 16px;
    margin-bottom: 20px;
    background-color: #e3f2fd;
    border-radius: 8px;
    color: #1976d2;
    font-weight: 500;
}
.form-group {
    margin-bottom: 20px;
}
label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}
textarea {
    width: 100%;
    min-height: 200px;
    padding: 16px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 12px;
    box-sizing: border-box;
    resize: vertical;
    background-color: #f8f9fa;
}
textarea:focus {
    outline: none;
    border-color: #FF3B30;
}
button {
    width: 100%;
    background: linear-gradient(135deg, #FF3B30, #FF6B35);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 16px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}
button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 59, 48, 0.3);
}
button:active {
    transform: translateY(0);
}
</style>
<title>PASS 본인인증</title>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo">PASS</div>
        <div class="subtitle">본인인증 서비스</div>
    </div>
    <div class="content">
        <div id="status" class="status">
            실제 PASS 본인인증을 시작합니다...
        </div>
        <div class="form-group">
            <label>인증 결과</label>
            <textarea id="result" readonly placeholder="PASS 본인인증 결과가 여기에 표시됩니다...&#10;&#10;• 실제 휴대폰 번호로 SMS 인증이 진행됩니다&#10;• 본인의 개인정보가 수집됩니다&#10;• 테스트가 아닌 실제 본인인증입니다"></textarea>
        </div>
        <button id="mok_popup">본인인증 시작하기</button>
    </div>
</div>
</body>
</html>